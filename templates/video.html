<html>

<style>
    html, body {
        margin: 0!important;
        padding: 0!important;
    }
</style>

<button id="start-camera">Start Camera</button>
<video id="video" width="320" height="240" autoplay></video>
<button id="start-record">Start Recording</button>
<button id="stop-record">Stop Recording</button>
<a id="download-video" download="test.webm">Download Video</a>


<br>

<hr>
{#<video controls autoplay playsinline></video>#}
{##}
{#<script src="{% static "js/RecordRTC.js" %}"></script>#}
{#<script>#}
{#var video = document.querySelector('video');#}
{##}
{#function captureCamera(callback) {#}
{#    navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(function(camera) {#}
{#        callback(camera);#}
{#    }).catch(function(error) {#}
{#        alert('Unable to capture your camera. Please check console logs.');#}
{#        console.error(error);#}
{#    });#}
{#}#}
{##}
{#function stopRecordingCallback() {#}
{#    video.src = video.srcObject = null;#}
{#    video.muted = false;#}
{#    video.volume = 1;#}
{#    video.src = URL.createObjectURL(recorder.getBlob());#}
{##}
{#    recorder.camera.stop();#}
{#    recorder.destroy();#}
{#    recorder = null;#}
{#}#}
{##}
{#var recorder; // globally accessible#}
{##}
{#document.getElementById('btn-start-recording').onclick = function() {#}
{#    this.disabled = true;#}
{#    captureCamera(function(camera) {#}
{#        video.muted = true;#}
{#        video.volume = 0;#}
{#        video.srcObject = camera;#}
{##}
{#        recorder = RecordRTC(camera, {#}
{#            type: 'video'#}
{#        });#}
{##}
{#        recorder.startRecording();#}
{##}
{#        // release camera on stopRecording#}
{#        recorder.camera = camera;#}
{##}
{#        document.getElementById('btn-stop-recording').disabled = false;#}
{#    });#}
{#};#}
{##}
{#document.getElementById('btn-stop-recording').onclick = function() {#}
{#    this.disabled = true;#}
{#    recorder.stopRecording(stopRecordingCallback);#}
{#};#}
{#</script>#}

<footer style="margin-top: 20px;"><small id="send-message"></small></footer>
<script src="https://www.webrtc-experiment.com/common.js"></script>
{##    var xhr = new XMLHttpRequest();#}
{##}
{#// Use JSFiddle logo as a sample image to avoid complicating#}
{#// this example with cross-domain issues.#}
{#xhr.open( "GET", "{{ link }}", true );#}
{##}
{#// Ask for the result as an ArrayBuffer.#}
{#xhr.responseType = "arraybuffer";#}
{##}
{#xhr.onload = function( e ) {#}
{#    // Obtain a blob: URL for the image data.#}
{#    var arrayBufferView = new Uint8Array( this.response );#}
{#    var blob = new Blob( [ arrayBufferView ], { type: "video/webm" } );#}
{#    var urlCreator = window.URL || window.webkitURL;#}
{#    var imageUrl = urlCreator.createObjectURL( blob );#}
{#    var img = document.querySelector( "#video" );#}
{#    img.src = imageUrl;#}
{##}
{#xhr.send();#}
       <script>


var camera_button = document.querySelector("#start-camera");
var video = document.querySelector("#video");
var start_button = document.querySelector("#start-record");
var stop_button = document.querySelector("#stop-record");
var download_link = document.querySelector("#download-video");

var camera_stream = null;
var media_recorder = null;
var blobs_recorded = [];
camera_button.addEventListener('click', async function() {

});

start_button.addEventListener('click', async function() {
    // set MIME type of recording as video/webm
    	camera_stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
	video.srcObject = camera_stream;
    media_recorder = new MediaRecorder(camera_stream, { mimeType: 'video/webm' });

    // event : new recorded video blob available
    media_recorder.addEventListener('dataavailable', function(e) {
		blobs_recorded.push(e.data);
    });

    // event : recording stopped & all blobs sent
    media_recorder.addEventListener('stop', function() {
    	// create local object URL from the recorded video blobs
    	let video_local = URL.createObjectURL(new Blob(blobs_recorded, { type: 'video/webm' }));
    	download_link.href = video_local;
    	window.download_link
    });

    // start recording with each recorded blob having 1 second video
    media_recorder.start(1000);
});

stop_button.addEventListener('click', function() {
	media_recorder.stop();
});
</script>
</html>